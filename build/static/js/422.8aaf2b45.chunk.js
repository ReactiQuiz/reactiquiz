"use strict";(self.webpackChunkreactiquiz=self.webpackChunkreactiquiz||[]).push([[422],{422:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ne});var a=s(267),r=s(3969),n=s(172),i=s(5895),o=s(3089),l=s(298),d=s(4799),c=s(6803),x=s(9826),m=s(5016),u=s(5043),h=s(411);var p=s(9379),g=s(3023),v=s(1911),A=s(8776),f=s(6154),y=s(256),j=s(9067),C=s(4938),b=s(7471),S=s(5877),w=s(2097),z=s(2929),k=s(579);const D=["6","7","8","9","10","11","12"];const M=function(e){var t;let{open:s,onClose:o,currentUser:l,setCurrentUser:d}=e;const m=(0,a.A)(),M=(null===(t=m.palette.accountAccent)||void 0===t?void 0:t.main)||m.palette.primary.main,[I,P]=(0,u.useState)({identifier:"",email:"",address:"",class:""}),[L,W]=(0,u.useState)(""),[E,T]=(0,u.useState)(""),[U,O]=(0,u.useState)(!1);(0,u.useEffect)((()=>{l&&s&&(P({identifier:l.name||"",email:l.email||"",address:l.address||"",class:String(l.class||"")}),W(""),T(""))}),[l,s]);const R=e=>{const{name:t,value:s}=e.target;P((e=>(0,p.A)((0,p.A)({},e),{},{[t]:s}))),W(""),T("")},q=async e=>{if(e.preventDefault(),W(""),T(""),I.address.trim()&&String(I.class).trim())if(D.includes(String(I.class))){O(!0);try{const e={address:I.address.trim(),class:parseInt(I.class)},t=await h.A.put("/api/users/update-details",e,{headers:{Authorization:"Bearer ".concat(l.token)}});if(T(t.data.message||"Details updated successfully!"),t.data.user&&d){d((e=>(0,p.A)((0,p.A)({},e),{},{address:t.data.user.address,class:t.data.user.class})));const e={id:l.id,name:l.name,email:l.email,address:t.data.user.address,class:t.data.user.class};localStorage.setItem("reactiquizUser",JSON.stringify(e))}setTimeout((()=>{o()}),2e3)}catch(a){var t,s;W((null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Failed to update details. Please try again.")}finally{O(!1)}}else W("Please select a valid class from the dropdown.");else W("Address and Class fields are required.")},Q=()=>{W(""),T(""),o()};return(0,k.jsxs)(g.A,{open:s,onClose:Q,PaperProps:{sx:{minWidth:{xs:"90%",sm:"450px"}}},children:[(0,k.jsx)(v.A,{sx:{backgroundColor:M,color:m.palette.getContrastText(M),pb:1.5,pt:2,textAlign:"center"},children:(0,k.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,k.jsx)(z.A,{sx:{mr:1}}),"Change Your Details"]})}),(0,k.jsxs)(A.A,{sx:{pt:"20px !important"},children:[(0,k.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Update your address and class. Username and email cannot be changed here."}),(0,k.jsxs)(r.A,{component:"form",onSubmit:q,noValidate:!0,sx:{mt:1},children:[(0,k.jsx)(f.A,{margin:"normal",fullWidth:!0,id:"identifier-display",label:"Username/Identifier",name:"identifier",value:I.identifier,disabled:!0,InputLabelProps:{shrink:!0}}),(0,k.jsx)(f.A,{margin:"normal",fullWidth:!0,id:"email-display",label:"Email Address",name:"email",type:"email",value:I.email,disabled:!0,InputLabelProps:{shrink:!0}}),(0,k.jsx)(f.A,{margin:"normal",required:!0,fullWidth:!0,id:"address-change",label:"Address",name:"address",autoComplete:"street-address",multiline:!0,rows:2,value:I.address,onChange:R,error:!!L&&L.toLowerCase().includes("address"),InputLabelProps:{shrink:!!I.address}}),(0,k.jsxs)(y.A,{fullWidth:!0,margin:"normal",required:!0,error:!!L&&L.toLowerCase().includes("class"),children:[(0,k.jsx)(j.A,{id:"class-select-label",children:"Class"}),(0,k.jsxs)(C.A,{labelId:"class-select-label",id:"class-change-select",name:"class",value:I.class,label:"Class",onChange:R,children:[(0,k.jsx)(b.A,{value:"",children:(0,k.jsx)("em",{children:"Select Class"})}),D.map((e=>(0,k.jsxs)(b.A,{value:e,children:[e,"th"]},e)))]}),!!L&&L.toLowerCase().includes("class")&&(0,k.jsx)(i.A,{color:"error",variant:"caption",children:L})]}),L&&!L.toLowerCase().includes("class")&&!L.toLowerCase().includes("address")&&(0,k.jsx)(c.A,{severity:"error",sx:{mt:2},children:L}),E&&(0,k.jsx)(c.A,{severity:"success",sx:{mt:2},children:E})]})]}),(0,k.jsxs)(S.A,{sx:{p:"16px 24px",justifyContent:"space-between"},children:[(0,k.jsx)(w.A,{onClick:Q,sx:{color:m.palette.text.secondary},children:"Cancel"}),(0,k.jsx)(w.A,{onClick:q,variant:"contained",disabled:U,sx:{backgroundColor:M,color:m.palette.getContrastText(M),"&:hover":{backgroundColor:(0,x.e$)(M,.15)}},startIcon:U?(0,k.jsx)(n.A,{size:20,color:"inherit"}):null,children:U?"Saving...":"Save Changes"})]})]})};var I=s(7873),P=s(4527),L=s(9118),W=s(1773),E=s(5767),T=s(5979),U=s(4321);const O=e=>{if(!e)return"N/A";const t=parseInt(e);return isNaN(t)?e:"Class ".concat(t,t%10===1&&t%100!==11?"st":t%10===2&&t%100!==12?"nd":t%10===3&&t%100!==13?"rd":"th")};const R=function(e){let{currentUser:t,userStats:s,isLoadingStats:o,statsError:m,onEditDetailsClick:u,onLogoutClick:h,accentColor:p}=e;const g=(0,a.A)(),v=p||g.palette.primary.main;return t?(0,k.jsxs)(d.A,{elevation:3,sx:{p:{xs:1.5,sm:2.5},display:"flex",flexDirection:"column",alignItems:"center",height:"100%",borderTop:"4px solid ".concat(v),width:"100%",boxSizing:"border-box",borderRadius:{xs:0,sm:g.shape.borderRadius}},children:[(0,k.jsx)(I.A,{sx:{width:{xs:100,sm:120,md:160},height:{xs:100,sm:120,md:160},mb:1.5,bgcolor:v,fontSize:{xs:"2.5rem",sm:"3rem",md:"3.5rem"},color:g.palette.getContrastText(v),border:"3px solid ".concat(g.palette.background.paper)},alt:t.name?t.name.charAt(0).toUpperCase():"",children:t.name?t.name.charAt(0).toUpperCase():(0,k.jsx)(L.A,{fontSize:"inherit"})}),(0,k.jsx)(i.A,{variant:"h5",component:"h1",sx:{fontWeight:"bold",textAlign:"center",wordBreak:"break-word",fontSize:{xs:"1.2rem",sm:"1.4rem",md:"1.6rem"}},children:t.name}),(0,k.jsx)(i.A,{variant:"subtitle1",color:"text.secondary",sx:{textAlign:"center",mb:1.5,fontSize:{xs:"0.85rem",sm:"0.95rem"}},children:O(t.class)}),(0,k.jsx)(P.A,{sx:{width:"90%",my:1.5}}),(0,k.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",mb:1.5,px:1,fontStyle:"italic",fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:t.address||"No address provided."}),(0,k.jsx)(P.A,{sx:{width:"90%",my:1.5}}),o?(0,k.jsx)(n.A,{sx:{my:1.5,color:v}}):m?(0,k.jsx)(c.A,{severity:"error",sx:{width:"100%",my:1,fontSize:"0.8rem"},children:m}):(0,k.jsxs)(l.A,{spacing:1,sx:{width:"100%",alignItems:"flex-start",px:1,my:1},children:[(0,k.jsxs)(r.A,{sx:{display:"flex",alignItems:"center"},children:[(0,k.jsx)(T.A,{sx:{color:g.palette.text.secondary,mr:1,fontSize:{xs:"1rem",sm:"1.125rem"}}}),(0,k.jsxs)(i.A,{variant:"body2",sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:["Avg. Score: ",(0,k.jsxs)(i.A,{component:"span",sx:{fontWeight:"bold",color:v,fontSize:"inherit"},children:[s.overallAveragePercentage,"%"]})]})]}),(0,k.jsxs)(r.A,{sx:{display:"flex",alignItems:"center"},children:[(0,k.jsx)(U.A,{sx:{color:g.palette.text.secondary,mr:1,fontSize:{xs:"1rem",sm:"1.125rem"}}}),(0,k.jsxs)(i.A,{variant:"body2",sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:["Tests Solved: ",(0,k.jsx)(i.A,{component:"span",sx:{fontWeight:"bold",color:v,fontSize:"inherit"},children:s.totalQuizzesSolved})]})]})]}),(0,k.jsx)(w.A,{fullWidth:!0,variant:"outlined",startIcon:(0,k.jsx)(W.A,{}),onClick:u,sx:{mt:2,borderColor:v,color:v,"&:hover":{backgroundColor:(0,x.X4)(v,.08)},fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:"Edit Profile Details"}),(0,k.jsx)(w.A,{fullWidth:!0,variant:"text",onClick:h,startIcon:(0,k.jsx)(E.A,{}),sx:{mt:1,color:g.palette.error.light,fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:"Logout"})]}):null};var q=s(1754),Q=s(6936),X=s(9594),B=s(5452),F=s(9002);const N=function(e){var t,s,r,n,l,c;let{onOpenChangePasswordModal:m,onOpenChangeDetailsModal:u,accentColor:h}=e;const p=(0,a.A)(),g=(0,F.Zp)(),v=h||p.palette.primary.main;return(0,k.jsxs)(d.A,{elevation:3,sx:{p:{xs:1.5,sm:2.5},borderTop:"3px solid ".concat(p.palette.primary.main),width:"100%",boxSizing:"border-box",borderRadius:{xs:0,sm:p.shape.borderRadius}},children:[(0,k.jsx)(i.A,{variant:"h6",gutterBottom:!0,sx:{color:p.palette.text.secondary,fontWeight:"medium",fontSize:{xs:"1rem",sm:"1.125rem"}},children:"Account Management"}),(0,k.jsxs)(o.A,{container:!0,spacing:1.5,children:[(0,k.jsx)(o.A,{item:!0,xs:12,sm:6,children:(0,k.jsx)(w.A,{fullWidth:!0,variant:"contained",startIcon:(0,k.jsx)(q.A,{}),onClick:m,sx:{backgroundColor:v,"&:hover":{backgroundColor:(0,x.e$)(v,.2)},fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:"Change Password"})}),(0,k.jsx)(o.A,{item:!0,xs:12,sm:6,children:(0,k.jsx)(w.A,{fullWidth:!0,variant:"contained",startIcon:(0,k.jsx)(Q.A,{}),onClick:u,sx:{backgroundColor:v,"&:hover":{backgroundColor:(0,x.e$)(v,.2)},fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:"Change Profile Details"})}),(0,k.jsx)(o.A,{item:!0,xs:12,sm:6,children:(0,k.jsx)(w.A,{fullWidth:!0,variant:"contained",startIcon:(0,k.jsx)(X.A,{}),onClick:()=>g("/friends"),sx:{backgroundColor:null===(t=p.palette.friendsAccent)||void 0===t?void 0:t.main,color:p.palette.getContrastText(null===(s=p.palette.friendsAccent)||void 0===s?void 0:s.main),"&:hover":{backgroundColor:(0,x.e$)(null===(r=p.palette.friendsAccent)||void 0===r?void 0:r.main,.2)},fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:"Manage Friends"})}),(0,k.jsx)(o.A,{item:!0,xs:12,sm:6,children:(0,k.jsx)(w.A,{fullWidth:!0,variant:"contained",startIcon:(0,k.jsx)(B.A,{}),onClick:()=>g("/challenges"),sx:{backgroundColor:null===(n=p.palette.challengesAccent)||void 0===n?void 0:n.main,color:p.palette.getContrastText(null===(l=p.palette.challengesAccent)||void 0===l?void 0:l.main),"&:hover":{backgroundColor:(0,x.e$)(null===(c=p.palette.challengesAccent)||void 0===c?void 0:c.main,.2)},fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:"My Challenges"})})]})]})};var $=s(8065),G=s(1620),H=s(6981),Y=s(3086),J=s(3031),V=s(5867),Z=s(6465),K=s(4653),_=s(6995);const ee=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],te=["Mon","Wed","Fri"],se=(e,t,s)=>{const a=s||t.palette.primary.main;return 0===e?(0,x.X4)(t.palette.text.disabled,.2):e<=2?(0,x.X4)(a,.35):e<=4?(0,x.X4)(a,.6):e<=7?(0,x.X4)(a,.85):a};const ae=function(e){let{activityData:t,accentColor:s}=e;const n=(0,a.A)(),o=(0,u.useRef)(null),[l,d]=(0,u.useState)(53),c=(0,_.A)(n.breakpoints.down("sm")),m=(0,u.useMemo)((()=>{const e=new Map;(t||[]).forEach((t=>{t.date&&"string"===typeof t.date&&e.set(t.date,t.count)}));const a=[],r=new Date;let i=(0,G.k)((0,H.f)(r,-364),{weekStartsOn:0});for(let t=0;t<53;t++){const r=[];let o=!1;for(let a=0;a<7;a++){const l=(0,H.f)(i,a),d=(0,Y.GP)(l,"yyyy-MM-dd"),c=e.get(d)||0;0===a||0===(0,J.P)(l)?0!==t&&(0,V.t)(l)===(0,V.t)((0,H.f)(l,-7))||(o=!0):(0,Z.r)(l,(0,G.k)(l,{weekStartsOn:0}))&&((0,V.t)(l),(0,V.t)((0,H.f)(l,-1))),r.push({date:l,count:c,color:se(c,n,s),dateString:d})}a.push({id:"week-".concat(t),days:r,monthLabel:0===(0,J.P)(r[0].date)&&r[0].date.getDate()<=7||0===t||o?(0,Y.GP)(r[0].date,"MMM"):null}),i=(0,H.f)(i,7)}return a}),[t,n,s]);(0,u.useEffect)((()=>{const e=()=>{if(o.current){const e=o.current.offsetWidth,t=(c?11:13)+3;if(t>0){const s=Math.floor(e/t);d(Math.max(5,Math.min(s,53)))}else d(c?20:53)}else d(c?20:53)};e();const t=setTimeout(e,100);return window.addEventListener("resize",e),()=>{clearTimeout(t),window.removeEventListener("resize",e)}}),[c,n.breakpoints.values.sm]);const h=(0,u.useMemo)((()=>m.slice(-l)),[m,l]);return t?(0===t.length&&m.every((e=>e.days.every((e=>0===e.count)))),(0,k.jsxs)(r.A,{sx:{display:"flex",alignItems:"flex-start",width:"100%",overflow:"hidden"},children:[(0,k.jsx)(r.A,{sx:{display:"flex",flexDirection:"column",mr:.5,pt:"".concat(20,"px"),width:"".concat(25,"px"),flexShrink:0},children:ee.map(((e,t)=>(0,k.jsx)(i.A,{variant:"caption",sx:{height:3+(c?11:13)-1,display:"flex",alignItems:"center",visibility:te.includes(e)?"visible":"hidden",fontSize:"0.6rem",lineHeight:1,color:n.palette.text.secondary},children:te.includes(e)?e.charAt(0):""},e)))}),(0,k.jsx)(r.A,{ref:o,sx:{display:"flex",flexDirection:"row",gap:"".concat(3,"px"),width:"100%",overflow:"hidden"},children:h.map((e=>{var t,s;return(0,k.jsxs)(r.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,k.jsx)(i.A,{variant:"caption",sx:{height:"".concat(20,"px"),fontSize:"0.65rem",color:n.palette.text.secondary,visibility:e.days[0].date.getDate()<=7||e.id===(null===(t=h[0])||void 0===t?void 0:t.id)?"visible":"hidden",minWidth:c?11:13,textAlign:"left",whiteSpace:"nowrap"},children:e.days[0].date.getDate()<=7||e.id===(null===(s=h[0])||void 0===s?void 0:s.id)?(0,Y.GP)(e.days[0].date,"MMM"):""}),e.days.map((e=>(0,k.jsx)($.A,{title:e.date>new Date?"Future date":"".concat(e.count," quiz").concat(1===e.count?"":"zes"," on ").concat((0,Y.GP)((0,K.H)(e.dateString),"MMM d, yyyy")),arrow:!0,placement:"top",children:(0,k.jsx)(r.A,{sx:{width:c?11:13,height:c?11:13,backgroundColor:e.date>new Date?(0,x.X4)(n.palette.action.disabledBackground,.3):e.color,borderRadius:"3px",cursor:e.date<=new Date&&e.count>0?"pointer":"default","&:hover":{outline:e.date<=new Date&&e.count>0?"1.5px solid ".concat((0,x.X4)(n.palette.getContrastText(e.color),.7)):"none"}}})},e.dateString)))]},e.id)}))})]})):(0,k.jsx)(i.A,{color:"text.secondary",sx:{textAlign:"center",py:2},children:"Loading activity data..."})};var re=s(3106);const ne=function(e){var t;let{onOpenChangePasswordModal:s}=e;const p=(0,a.A)(),{currentUser:g,logout:v,updateCurrentUserDetails:A}=(0,m.A)(),f=(null===(t=p.palette.accountAccent)||void 0===t?void 0:t.main)||p.palette.primary.main,{userStats:y,isLoadingStats:j,statsError:C,changeDetailsModalOpen:b,handleOpenChangeDetailsModal:S,handleCloseChangeDetailsModal:w}=(()=>{const{currentUser:e}=(0,m.A)(),[t,s]=(0,u.useState)(!1),[a,r]=(0,u.useState)({totalQuizzesSolved:0,overallAveragePercentage:0,activityData:[]}),[n,i]=(0,u.useState)(!1),[o,l]=(0,u.useState)(""),d=(0,u.useCallback)((async()=>{if(!e||!e.token)return r({totalQuizzesSolved:0,overallAveragePercentage:0,activityData:[]}),void i(!1);i(!0),l("");try{const t=await h.A.get("/api/users/stats",{headers:{Authorization:"Bearer ".concat(e.token)}});r({totalQuizzesSolved:t.data.totalQuizzesSolved||0,overallAveragePercentage:t.data.overallAveragePercentage||0,activityData:t.data.activityData||[]})}catch(a){var t,s;console.error("Error fetching user account stats:",a),l((null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Failed to load your statistics."),r({totalQuizzesSolved:0,overallAveragePercentage:0,activityData:[]})}finally{i(!1)}}),[e]);return(0,u.useEffect)((()=>{e?d():(r({totalQuizzesSolved:0,overallAveragePercentage:0,activityData:[]}),l(""),i(!1))}),[e,d]),{userStats:a,isLoadingStats:n,statsError:o,changeDetailsModalOpen:t,handleOpenChangeDetailsModal:()=>s(!0),handleCloseChangeDetailsModal:()=>s(!1)}})();return g?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(r.A,{sx:{width:"100%",p:{xs:1,sm:1,md:2,lg:3},backgroundColor:p.palette.background.default,margin:"0 auto"},children:(0,k.jsxs)(o.A,{container:!0,children:[(0,k.jsx)(o.A,{item:!0,sx:{width:{xs:"100%",sm:"100%",md:"24.5%",lg:"24.5%",xl:"24.5%"},marginLeft:{xs:"0%",sm:"0%",md:"0%",lg:"2%",xl:"2%"},paddingRight:{md:"1%",lg:"1%",xl:"1%"},marginBottom:{xs:2,sm:2,md:0}},children:(0,k.jsx)(R,{currentUser:g,userStats:y,isLoadingStats:j,statsError:C,onEditDetailsClick:S,onLogoutClick:v,accentColor:f})}),(0,k.jsx)(o.A,{item:!0,sx:{width:{xs:"100%",sm:"100%",md:"74.5%",lg:"72.5%",xl:"72.5%"}},children:(0,k.jsxs)(l.A,{spacing:{xs:2,md:3},width:"100%",children:[(0,k.jsx)(N,{onOpenChangePasswordModal:s,onOpenChangeDetailsModal:S,accentColor:f}),(0,k.jsxs)(d.A,{elevation:3,sx:{p:{xs:1.5,sm:2,md:3},borderTop:"3px solid ".concat(p.palette.info.main),width:"100%",boxSizing:"border-box",borderRadius:{xs:0,sm:p.shape.borderRadius}},children:[(0,k.jsxs)(i.A,{variant:"h6",gutterBottom:!0,sx:{color:p.palette.text.secondary,fontWeight:"medium",display:"flex",alignItems:"center",fontSize:{xs:"1rem",sm:"1.125rem"}},children:[(0,k.jsx)(re.A,{sx:{mr:1,color:p.palette.info.light}})," Quiz Activity (Last Year)"]}),j?(0,k.jsx)(r.A,{sx:{height:200,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,k.jsx)(n.A,{sx:{color:p.palette.info.main}})}):C?(0,k.jsx)(c.A,{severity:"warning",sx:{mt:1,fontSize:"0.8rem"},children:"Could not load activity: ".concat(C)}):y.activityData&&y.activityData.length>0?(0,k.jsx)(ae,{activityData:y.activityData,accentColor:f}):(0,k.jsx)(r.A,{sx:{height:150,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:(0,x.X4)(p.palette.background.default,.5),borderRadius:1},children:(0,k.jsx)(i.A,{color:"text.secondary",sx:{fontSize:"0.875rem"},children:"No quiz activity recorded yet."})})]})]})})]})}),(0,k.jsx)(M,{open:b,onClose:w,currentUser:g,setCurrentUser:A})]}):(0,k.jsxs)(r.A,{sx:{p:3,textAlign:"center"},children:[(0,k.jsx)(n.A,{}),(0,k.jsx)(i.A,{children:"Loading user..."})]})}}}]);
//# sourceMappingURL=422.8aaf2b45.chunk.js.map