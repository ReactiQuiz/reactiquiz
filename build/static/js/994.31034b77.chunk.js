"use strict";(self.webpackChunkreactiquiz=self.webpackChunkreactiquiz||[]).push([[994],{441:(e,t,n)=>{n.d(t,{A:()=>h});var i=n(9379),o=n(45),a=(n(5043),n(7395)),r=n(3684),s=n(809),c=n(5895),l=n(1202),u=n(579);const d=["node"],p=["node"];const h=function(e){let{text:t}=e;return t?(0,u.jsx)(a.oz,{remarkPlugins:[r.A],rehypePlugins:[s.A],components:{p:e=>{let{node:t}=e,n=(0,o.A)(e,d);return(0,u.jsx)(c.A,(0,i.A)({variant:"inherit",component:"div",sx:{mt:1,mb:1}},n))},a:e=>{let{node:t}=e,n=(0,o.A)(e,p);return(0,u.jsx)(l.A,(0,i.A)({},n))}},children:t}):null}},1386:(e,t,n)=>{n.d(t,{f:()=>i});const i=e=>{if(null==e||"number"!==typeof e||e<0)return"N/A";const t=Math.floor(e/3600),n=Math.floor(e%3600/60),i=Math.floor(e%60),o=String(t).padStart(2,"0"),a=String(n).padStart(2,"0"),r=String(i).padStart(2,"0");return t>0?"".concat(o,"h ").concat(a,"m ").concat(r,"s"):n>0?"".concat(a,"m ").concat(r,"s"):"".concat(r,"s")}},8994:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var i=n(3969),o=n(172),a=n(5895),r=n(6803),s=n(2097),c=n(4799),l=n(9002),u=n(267),d=n(9826),p=n(9379),h=n(5043),m=n(411),f=n(5016),g=n(9468);const A=async(e,t,n,i)=>{try{const o=await m.A.get("/api/topics/".concat(e.toLowerCase()));if(!Array.isArray(o.data)||0===o.data.length)return[];const a=o.data.map((e=>e.id));if(0===a.length)return[];let r=[];for(const t of a){const n=await m.A.get("/api/questions?topicId=".concat(t));if(Array.isArray(n.data)){const i=o.data.find((e=>e.id===t));r.push(...n.data.map((t=>(0,p.A)((0,p.A)({},t),{},{subject:e.toLowerCase(),class:t.class||(null===i||void 0===i?void 0:i.class)||null}))))}}if(0===r.length)return[];let s=t?r.filter((e=>!e.class||String(e.class)===String(t))):r;if(0===s.length&&t&&(s=r),"mixed"===n)return(0,g.R3)(s).slice(0,i);let c=0,l=1/0;"easy"===n?(c=10,l=13):"medium"===n?(c=14,l=17):"hard"===n&&(c=18,l=20);let u=s.filter((e=>e.difficulty>=c&&e.difficulty<=l));return 0===u.length&&(u=s),(0,g.R3)(u).slice(0,i)}catch(o){return console.error("[PracticeQuiz] Error fetching for ".concat(e,":"),o),[]}},x=()=>{const{currentUser:e}=(0,f.A)(),{topicId:t,challengeId:n}=(0,l.g)(),i=(0,l.Zp)(),o=(0,l.zy)(),a=o.state||{},[r,s]=(0,h.useState)([]),[c,u]=(0,h.useState)({}),[d,x]=(0,h.useState)(!0),[y,b]=(0,h.useState)(""),[v,C]=(0,h.useState)(""),[j,q]=(0,h.useState)(0),[w,S]=(0,h.useState)(!1),[z,I]=(0,h.useState)(!1),[k,Q]=(0,h.useState)({}),T=(0,h.useCallback)((()=>{if(null===e||void 0===e||!e.id||!t&&!n)return null;const i=n?"challenge-".concat(n):t;return"quiz-in-progress-".concat(e.id,"-").concat(i)}),[null===e||void 0===e?void 0:e.id,t,n]),L=(0,h.useCallback)((()=>{const e=T();e&&localStorage.removeItem(e)}),[T]),U=(0,h.useCallback)((async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(z)return;if(S(!1),L(),t)return void i(k.subject?"/subjects/".concat(k.subject):"/subjects");I(!0);let n=0;r.forEach((e=>{c[e.id]===e.correctOptionId&&n++}));const o=n,a=r.length>0?Math.round(o/r.length*100):0;let s=null;if(null!==e&&void 0!==e&&e.token)try{const t={userId:e.id,subject:k.subject,topicId:k.topicId,score:o,totalQuestions:r.length,percentage:a,timestamp:(new Date).toISOString(),difficulty:k.difficulty,numQuestionsConfigured:k.numQuestions,class:k.quizClass,timeTaken:j,questionsActuallyAttemptedIds:r.map((e=>e.id)),userAnswersSnapshot:c,challenge_id:k.challengeId||null};s=(await m.A.post("/api/results",t,{headers:{Authorization:"Bearer ".concat(e.token)}})).data.id,k.challengeId&&s&&await m.A.put("/api/challenges/".concat(k.challengeId,"/submit"),{score:o,percentage:a,timeTaken:j,resultId:s},{headers:{Authorization:"Bearer ".concat(e.token)}})}catch(u){console.error("Failed to save result/submit challenge score",u)}const l=s||function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;const t=new Uint8Array(e);return window.crypto.getRandomValues(t),Array.from(t,(e=>e.toString(16).padStart(2,"0"))).join("").slice(0,e)}();i("/results/".concat(l),{state:(0,p.A)((0,p.A)({},k),{},{originalQuestionsForDisplay:r,originalAnswersForDisplay:c,score:o,percentage:a,savedToHistory:!!s,isFirstResultView:!0})})}),[z,c,r,i,e,k,j,L]);(0,h.useEffect)((()=>{const i=T();(async()=>{if(x(!0),b(""),C(""),i){const e=localStorage.getItem(i);if(e)try{const t=JSON.parse(e);return s(t.questions),u(t.userAnswers),q(t.elapsedTime),Q(t.quizContext),S(!0),void x(!1)}catch(o){localStorage.removeItem(i)}}try{const o=a.quizType||(n?"challenge":"standard");let r=[],c={};if("challenge"===o&&n){if(null===e||void 0===e||!e.token)throw new Error("You must be logged in to play a challenge.");const{challengeData:t,questions:i}=await(async(e,t)=>{const n=await m.A.get("/api/challenges/".concat(e),{headers:{Authorization:"Bearer ".concat(t)}});if(!n.data||!Array.isArray(n.data.question_ids))throw new Error("Challenge data is invalid.");const i=(await m.A.get("/api/questions?topicId=".concat(n.data.topic_id))).data;if(!Array.isArray(i))throw new Error("Invalid question data for challenge topic.");const o=n.data.question_ids.map((e=>i.find((t=>t.id===e)))).filter(Boolean);if(0===o.length)throw new Error("No valid questions found for this challenge.");return{challengeData:n.data,questions:o.map((e=>(0,p.A)((0,p.A)({},e),{},{subject:n.data.subject,class:n.data.quiz_class})))}})(n,e.token);r=i,c=(0,p.A)((0,p.A)({},t),{},{topicName:t.topic_name,quizClass:t.quiz_class,challengeId:t.id,numQuestionsConfigured:t.num_questions})}else if("homibhabha-practice"===o){const{questions:e,info:t}=await(async e=>{const{quizClassFromState:t,difficultyLabel:n,questionComposition:i,desiredTotal:o}=e;let a=[],r=[];for(const c of["physics","chemistry","biology","gk"])if(i[c]){const e=await A(c,t,n,i[c]);a.push(...e),e.length<i[c]&&r.push("Found ".concat(e.length,"/").concat(i[c]," ").concat(c," questions."))}const s=Array.from(new Map(a.map((e=>[e.id,e]))).values());if(0===s.length)throw new Error("Could not gather any questions for the practice test.");return{questions:(0,g.R3)(s).slice(0,o),info:r.join(" ")}})({quizClassFromState:a.quizClass,difficultyLabel:a.difficulty,questionComposition:a.questionComposition,desiredTotal:a.totalQuestions});r=e,t&&C(t),c=(0,p.A)((0,p.A)({},a),{},{topicId:"homibhabha-practice-".concat(a.quizClass,"-").concat(a.difficulty)})}else{if(!t)throw new Error("Quiz configuration is missing or invalid.");r=await(async e=>{const{topicId:t,quizClassFromState:n,difficultyLabel:i,numQuestionsReq:o,subject:a}=e;let r=(await m.A.get("/api/questions?topicId=".concat(t))).data;if(!Array.isArray(r))throw new Error("Invalid question data received.");if(n&&a&&!["gk","mathematics"].includes(a.toLowerCase())&&(r=r.filter((e=>!e.class||String(e.class)===String(n)))),"mixed"!==i){let e=0,t=1/0;"easy"===i?(e=10,t=13):"medium"===i?(e=14,t=17):"hard"===i&&(e=18,t=20);const n=r.filter((n=>n.difficulty>=e&&n.difficulty<=t));n.length>0&&(r=n)}if(0===r.length)throw new Error('No questions found for topic "'.concat(t,'" with the selected filters.'));return(0,g.R3)(r).slice(0,o)})({topicId:t,quizClassFromState:a.quizClass,difficultyLabel:a.difficulty,numQuestionsReq:a.numQuestions,subject:a.subject}),c=(0,p.A)((0,p.A)({},a),{},{topicId:t})}const l=(0,g.a3)(r);if(s(l),Q(c),u({}),q(0),r.length>0&&(S(!0),i)){const e={questions:l,userAnswers:{},elapsedTime:0,quizContext:c};localStorage.setItem(i,JSON.stringify(e))}}catch(r){b("Failed to load quiz: ".concat(r.message||"Unknown error"))}x(!1)})()}),[t,n,o.state,e,T]),(0,h.useEffect)((()=>{let e;return w&&r.length>0&&(e=setInterval((()=>{q((t=>{const n=t+1,i=T();if(i)try{const e=JSON.parse(localStorage.getItem(i)||"{}");e.elapsedTime=n,localStorage.setItem(i,JSON.stringify(e))}catch(o){}return k.timeLimit&&n>=k.timeLimit?(clearInterval(e),U(),k.timeLimit):n}))}),1e3)),()=>clearInterval(e)}),[w,r.length,k.timeLimit,U,T]);return{questions:r,userAnswers:c,isLoading:d,error:y,infoMessage:v,elapsedTime:j,timerActive:w,isSubmitting:z,quizContext:k,handleOptionSelect:(e,t)=>{const n=(0,p.A)((0,p.A)({},c),{},{[e]:t});u(n);const i=T();if(i)try{const e=JSON.parse(localStorage.getItem(i)||"{}");e.userAnswers=n,localStorage.setItem(i,JSON.stringify(e))}catch(o){}},submitAndNavigate:U,handleAbandonQuiz:()=>{window.confirm("Are you sure you want to abandon this quiz? Your progress will be lost and you will be returned to the topics list.")&&U(!0)}}};var y=n(3777),b=n(1386),v=n(9992),C=n(579);const j=(0,v.A)((0,C.jsx)("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"}),"Replay");const q=function(e){let{quizType:t,effectiveSubject:n,effectiveTopicName:o,effectiveQuizClass:c,effectiveDifficulty:l,questionsLength:p,currentChallengeDetails:h,currentUser:m,timerActive:f,elapsedTime:g,effectiveTimeLimit:A,accentColor:x,infoMessage:y,onAbandon:v}=e;const q=(0,u.A)(),w=x||q.palette.primary.main,S=A?Math.max(0,A-g):g,z=A&&S<600?q.palette.error.main:q.palette.text.primary,I=A&&S<600?q.palette.error.main:q.palette.text.primary;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(i.A,{sx:{position:"fixed",top:{xs:"calc(56px + ".concat(q.spacing(1),")"),sm:"calc(64px + ".concat(q.spacing(1),")")},left:"50%",transform:"translateX(-50%)",backgroundColor:(0,d.X4)(q.palette.background.paper,.95),color:I,padding:q.spacing(.75,2),borderRadius:q.shape.borderRadius,zIndex:1050,boxShadow:q.shadows[3],minWidth:"100px",textAlign:"center",border:"1px solid ".concat((0,d.X4)(z,.5)),display:(f||g>0)&&p>0?"block":"none"},children:(0,C.jsxs)(a.A,{variant:"h6",component:"div",sx:{fontWeight:500,lineHeight:1.2,fontSize:"1rem"},children:[A?"Time Left: ":"Time: "," ",(0,b.f)(S)]})}),y&&(0,C.jsx)(r.A,{severity:"info",sx:{my:2,mt:8},children:y}),(0,C.jsx)(a.A,{variant:"h4",gutterBottom:!0,component:"div",sx:{mb:1,textAlign:"center",color:w,fontWeight:"bold",fontSize:{xs:"1.8rem",sm:"2.125rem"},mt:!y&&(f||g>0)&&p>0?8:f||g>0?1:4.5},children:(()=>{var e;return"challenge"===t&&h?"Challenge: ".concat(h.topic_name||(null===(e=h.topic_id)||void 0===e?void 0:e.replace(/-/g," "))||"Quiz"):n?"".concat(n.charAt(0).toUpperCase()+n.slice(1)," Quiz"):"Quiz"})()}),(0,C.jsx)(a.A,{variant:"h6",component:"div",sx:{mb:2,textAlign:"center",color:q.palette.text.secondary,fontWeight:"normal",textTransform:"capitalize",fontSize:{xs:"1rem",sm:"1.125rem"}},children:(()=>{let e=[];if("challenge"!==t)e.push("Topic: ".concat(o));else if(h){const t=h.challenger_id===(null===m||void 0===m?void 0:m.id)?h.challengedUsername?"You challenged ".concat(h.challengedUsername):"Awaiting opponent":h.challengerUsername||"A User";e.push("Challenged by: ".concat(t))}return c&&e.push("(Class ".concat(c,")")),l&&e.push(l.charAt(0).toUpperCase()+l.slice(1)),p>0&&e.push("".concat(p," Questions")),e.join(" ")})()}),v&&(0,C.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",mb:2},children:(0,C.jsx)(s.A,{onClick:v,variant:"text",color:"error",size:"small",startIcon:(0,C.jsx)(j,{}),children:"Abandon & Start Over"})}),"challenge"===t&&(null===h||void 0===h?void 0:h.challenger_id)!==(null===m||void 0===m?void 0:m.id)&&null!==(null===h||void 0===h?void 0:h.challenger_score)&&(0,C.jsxs)(r.A,{severity:"info",sx:{mb:2},children:["Your opponent ",h.challengerUsername||"has"," already completed this challenge, scoring ",h.challenger_score,"/",h.num_questions,". Good luck!"]})]})};var w=n(441);const S=e=>{let{question:t,questionNumber:n,onOptionSelect:o,selectedOptionId:r,accentColor:l}=e;const p=(0,u.A)(),h=l||p.palette.primary.main;return(0,C.jsxs)(c.A,{elevation:2,sx:{p:{xs:2,sm:3},mb:3,width:"100%",borderRadius:2},children:[(0,C.jsxs)(a.A,{variant:"h6",gutterBottom:!0,component:"div",sx:{color:p.palette.text.secondary,fontWeight:500},children:["Question ",n,":"]}),(0,C.jsx)(i.A,{sx:{mb:2.5,color:p.palette.text.primary,fontSize:"1.1rem"},children:(0,C.jsx)(w.A,{text:t.text})}),(0,C.jsx)(i.A,{display:"flex",flexDirection:"column",gap:1.5,children:t.options.map((e=>{const n=e.id===r;return(0,C.jsx)(s.A,{variant:n?"contained":"outlined",fullWidth:!0,onClick:()=>o(t.id,e.id),sx:{justifyContent:"flex-start",textAlign:"left",py:1.5,px:2,borderRadius:"8px",borderColor:(0,d.X4)(h,.5),color:n?p.palette.getContrastText(h):p.palette.text.primary,backgroundColor:n?h:"transparent","&:hover":{borderColor:h,backgroundColor:n?(0,d.e$)(h,.15):(0,d.X4)(h,.08)},textTransform:"none",fontSize:"1rem",lineHeight:1.5,fontWeight:n?500:400},children:(0,C.jsx)(w.A,{text:e.text})},e.id)}))})]})};const z=function(e){let{questions:t,userAnswers:n,onOptionSelect:i,currentAccentColor:o}=e;return t&&0!==t.length?(0,C.jsx)(C.Fragment,{children:t.map(((e,t)=>(0,C.jsx)(S,{question:e,questionNumber:t+1,selectedOptionId:n[e.id],onOptionSelect:i,accentColor:o},e.id||"q-".concat(t,"-").concat(Math.random()))))}):null};const I=function(){var e;const t=(0,u.A)(),n=(0,l.Zp)(),{currentUser:p}=(0,f.A)(),{questions:h,userAnswers:m,isLoading:g,error:A,infoMessage:b,elapsedTime:v,timerActive:j,isSubmitting:w,quizContext:S,handleOptionSelect:I,submitAndNavigate:k,handleAbandonQuiz:Q}=x(),T=y.J[null===(e=S.subject)||void 0===e?void 0:e.toLowerCase()]||S.accentColor||t.palette.primary.main;return g?(0,C.jsxs)(i.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:[(0,C.jsx)(o.A,{sx:{color:T}}),(0,C.jsx)(a.A,{sx:{ml:2},children:"Loading Quiz..."})]}):A?(0,C.jsxs)(i.A,{sx:{p:3,maxWidth:"900px",margin:"auto",textAlign:"center"},children:[(0,C.jsx)(r.A,{severity:"error",children:A}),(0,C.jsx)(s.A,{variant:"outlined",onClick:()=>n("/"),sx:{mt:2,borderColor:T,color:T},children:"Back to Home"})]}):g||0!==h.length?(0,C.jsxs)(i.A,{sx:{p:{xs:1,sm:2,md:3},maxWidth:"900px",margin:"auto"},children:[(0,C.jsx)(c.A,{elevation:3,sx:{p:{xs:2,sm:3},mb:3,borderTop:"4px solid ".concat(T)},children:(0,C.jsx)(q,{quizType:S.quizType,effectiveSubject:S.subject,effectiveTopicName:S.topicName,effectiveQuizClass:S.quizClass,effectiveDifficulty:S.difficulty,questionsLength:h.length,currentChallengeDetails:S.challengeId?S:null,currentUser:p,timerActive:j,elapsedTime:v,effectiveTimeLimit:S.timeLimit,accentColor:T,infoMessage:b,onAbandon:Q})}),(0,C.jsx)(z,{questions:h,userAnswers:m,onOptionSelect:I,currentAccentColor:T}),(0,C.jsx)(i.A,{display:"flex",justifyContent:"center",sx:{mt:3,mb:4},children:(0,C.jsx)(s.A,{variant:"contained",size:"large",onClick:()=>k(),disabled:w||0===h.length,sx:{backgroundColor:T,color:t.palette.getContrastText(T),"&:hover":{backgroundColor:(0,d.e$)(T,.15)},minWidth:"220px",py:1.5,fontSize:"1.1rem"},children:w?(0,C.jsx)(o.A,{size:26,color:"inherit"}):"Submit Quiz"})})]}):(0,C.jsxs)(i.A,{sx:{p:3,maxWidth:"900px",margin:"auto",textAlign:"center"},children:[(0,C.jsx)(a.A,{variant:"h5",gutterBottom:!0,children:"No Questions Available"}),(0,C.jsx)(a.A,{children:"No questions are currently available for the selected settings. Please try again."}),(0,C.jsxs)(s.A,{variant:"outlined",onClick:()=>n(S.subject?"/subjects/".concat(S.subject):"/subjects"),sx:{mt:3,borderColor:T,color:T},children:["Back to ",S.subject?S.subject.charAt(0).toUpperCase()+S.subject.slice(1):"Subjects"]})]})}},9468:(e,t,n)=>{n.d(t,{R3:()=>r,a3:()=>o,u0:()=>a});var i=n(9379);const o=e=>Array.isArray(e)?e.map((e=>{if(!e||"object"!==typeof e)return console.warn("[quizUtils] Encountered invalid item in questionsArray:",e),e;let t=[];if("string"===typeof e.options)try{t=JSON.parse(e.options),Array.isArray(t)||(console.warn("[quizUtils] Parsed options for Q ID ".concat(e.id," is not an array:"),t),t=[])}catch(n){console.error("[quizUtils] Failed to parse options for question ID ".concat(e.id,":"),e.options,n)}else Array.isArray(e.options)?t=e.options:void 0!==e.options&&null!==e.options&&console.warn("[quizUtils] Question ID ".concat(e.id," has unexpected options format (not string or array):"),e.options);return(0,i.A)((0,i.A)({},e),{},{options:t})})):(console.warn("[quizUtils] parseQuestionOptions received non-array input:",e),[]),a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(n&&null!==i&&void 0!==i&&i.topic_name)return"Challenge: ".concat(i.topic_name);if(n&&t)return"Challenge: ".concat(t);if(n)return"Challenge: ".concat(e?String(e).replace(/-/g," "):"Quiz");if(t&&e&&t!==String(e).replace(/-/g," "))return t;if(!e)return"N/A";let o=String(e).replace(/-/g," ");o=o.replace(/^homibhabha practice /i,"Homi Bhabha Practice - "),o=o.replace(/^pyq /i,"PYQ ");return o=o.replace(/\s(\d+(?:st|nd|rd|th))$/i,((e,t)=>" - Class ".concat(t.toUpperCase()))).trim(),o=o.split(" ").map((e=>"class"===e.toLowerCase()||"std"===e.toLowerCase()?e:e.includes("-")?e.split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join("-"):e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(" "),o=o.replace(/Homi Bhabha Practice - (\w+) (\w+)/i,((e,t,n)=>"Homi Bhabha Practice - Std ".concat(t," (").concat(n.charAt(0).toUpperCase()+n.slice(1),")"))),o=o.replace(/Pyq (\w+) (\d+)/i,((e,t,n)=>"PYQ - Std ".concat(t," (").concat(n,")"))),o=o.replace(/Pyq - Class (\w+) \((\d+)\)/i,((e,t,n)=>"PYQ - Std ".concat(t," (").concat(n,")"))),o},r=e=>{if(!e||!Array.isArray(e))return[];let t,n=e.length;for(;0!==n;)t=Math.floor(Math.random()*n),n--,[e[n],e[t]]=[e[t],e[n]];return e}}}]);
//# sourceMappingURL=994.31034b77.chunk.js.map