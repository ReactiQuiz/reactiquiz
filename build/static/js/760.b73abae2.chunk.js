"use strict";(self.webpackChunkreactiquiz=self.webpackChunkreactiquiz||[]).push([[760],{2199:(e,t,n)=>{n.d(t,{A:()=>y});var l=n(5043),s=n(267),a=n(3023),o=n(1911),i=n(8776),r=n(5895),c=n(3969),d=n(172),u=n(256),h=n(9067),p=n(4938),g=n(7471),x=n(6803),m=n(5877),A=n(2097),f=n(9826),j=n(5452),v=n(411),C=n(579);const y=function(e){var t;let{open:n,onClose:y,currentUser:b,quizDataForChallenge:S,accentColor:z}=e;const q=(0,s.A)(),[w,k]=(0,l.useState)([]),[I,_]=(0,l.useState)(!1),[L,P]=(0,l.useState)(""),[D,R]=(0,l.useState)(""),[U,F]=(0,l.useState)(""),[T,N]=(0,l.useState)(!1),B=z||q.palette.secondary.main,Q=(0,l.useCallback)((async()=>{if(null!==b&&void 0!==b&&b.token){_(!0),R("");try{const e=await v.A.get("/api/friends",{headers:{Authorization:"Bearer ".concat(b.token)}});k(e.data||[])}catch(e){R("Failed to load your friends list."),console.error("Error fetching friends:",e)}finally{_(!1)}}}),[null===b||void 0===b?void 0:b.token]);return(0,l.useEffect)((()=>{n&&(Q(),P(""),R(""),F(""),N(!1))}),[n,Q]),(0,C.jsxs)(a.A,{open:n,onClose:y,PaperProps:{sx:{minWidth:"320px",maxWidth:"500px"}},children:[(0,C.jsx)(o.A,{sx:{backgroundColor:B,color:q.palette.getContrastText(B),pb:1.5,pt:2},children:"Challenge a Friend"}),(0,C.jsxs)(i.A,{sx:{pt:"20px !important",display:"flex",flexDirection:"column",gap:2},children:[(0,C.jsx)(r.A,{variant:"body2",gutterBottom:!0,children:"You are about to challenge a friend using the following quiz:"}),(0,C.jsxs)(c.A,{sx:{pl:1,borderLeft:"3px solid ".concat(B),mb:1},children:[(0,C.jsxs)(r.A,{variant:"body2",children:[(0,C.jsx)("strong",{children:"Topic:"})," ",(null===S||void 0===S?void 0:S.topicName)||"N/A"]}),(0,C.jsxs)(r.A,{variant:"body2",children:[(0,C.jsx)("strong",{children:"Difficulty:"})," ",(null===S||void 0===S?void 0:S.difficulty)||"N/A"]}),(0,C.jsxs)(r.A,{variant:"body2",children:[(0,C.jsx)("strong",{children:"Questions:"})," ",(null===S||void 0===S||null===(t=S.questionIds)||void 0===t?void 0:t.length)||"N/A"]}),(null===S||void 0===S?void 0:S.quizClass)&&(0,C.jsxs)(r.A,{variant:"body2",children:[(0,C.jsx)("strong",{children:"Class:"})," ",S.quizClass]}),(null===S||void 0===S?void 0:S.subject)&&(0,C.jsxs)(r.A,{variant:"body2",children:[(0,C.jsx)("strong",{children:"Subject:"})," ",S.subject]})]}),I?(0,C.jsx)(d.A,{sx:{alignSelf:"center",color:B}}):(0,C.jsxs)(u.A,{fullWidth:!0,margin:"normal",disabled:0===w.length,children:[(0,C.jsx)(h.A,{id:"select-friend-label-challenge",children:"Select Friend to Challenge"}),(0,C.jsxs)(p.A,{labelId:"select-friend-label-challenge",value:L,label:"Select Friend to Challenge",onChange:e=>P(e.target.value),MenuProps:{PaperProps:{sx:{backgroundColor:q.palette.background.paper}}},children:[(0,C.jsx)(g.A,{value:"",children:(0,C.jsx)("em",{children:"-- Select a Friend --"})}),w.map((e=>(0,C.jsx)(g.A,{value:e.friendId,children:e.friendUsername},e.friendId)))]}),0===w.length&&!I&&(0,C.jsx)(r.A,{variant:"caption",color:"text.secondary",children:"You have no friends to challenge. Add friends from the 'Manage Friends' page."})]}),D&&(0,C.jsx)(x.A,{severity:"error",sx:{mt:1},children:D}),U&&(0,C.jsx)(x.A,{severity:"success",sx:{mt:1},children:U})]}),(0,C.jsxs)(m.A,{sx:{p:"16px 24px"},children:[(0,C.jsx)(A.A,{onClick:y,sx:{color:B},children:"Cancel"}),(0,C.jsx)(A.A,{onClick:async()=>{if(L)if(S&&S.questionIds&&0!==S.questionIds.length&&S.subject){N(!0),R(""),F("");try{const e={challenged_friend_id:L,topic_id:S.topicId,topic_name:S.topicName,difficulty:S.difficulty,num_questions:S.questionIds.length,quiz_class:S.quizClass||null,question_ids_json:JSON.stringify(S.questionIds),subject:S.subject},t=await v.A.post("/api/challenges",e,{headers:{Authorization:"Bearer ".concat(b.token)}});F(t.data.message||"Challenge sent successfully!"),setTimeout((()=>{y()}),2e3)}catch(n){var e,t;R((null===(e=n.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to send challenge. They might already be in a challenge or an error occurred."),console.error("Error sending challenge:",n.response||n)}finally{N(!1)}}else R("Quiz data for challenge is incomplete or missing subject.");else R("Please select a friend to challenge.")},variant:"contained",disabled:T||I||!L||0===w.length,sx:{backgroundColor:B,color:q.palette.getContrastText(B),"&:hover":{backgroundColor:(0,f.e$)(B,.2)}},startIcon:T?(0,C.jsx)(d.A,{size:20,color:"inherit"}):(0,C.jsx)(j.A,{}),children:T?"Sending...":"Send Challenge"})]})]})}},5362:(e,t,n)=>{n.d(t,{A:()=>a});var l=n(9992),s=n(579);const a=(0,l.A)((0,s.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},5760:(e,t,n)=>{n.r(t),n.d(t,{default:()=>w});var l=n(267),s=n(3969),a=n(172),o=n(5895),i=n(4799),r=n(2097),c=n(9826),d=n(4527),u=n(9002),h=n(5452),p=n(5016),g=n(5043),x=n(411);var m=n(3777),A=n(2199),f=n(6803),j=n(5315),v=n(7872),C=n(579);const y=function(e){let{results:t,isLoading:n,error:i,onInitiateChallenge:c,accentColor:d}=e;const u=(0,l.A)(),[h,p]=(0,g.useState)(!1),x=d||u.palette.secondary.main;return n?(0,C.jsx)(a.A,{sx:{color:x,display:"block",mx:"auto",my:2}}):i?(0,C.jsx)(f.A,{severity:"warning",sx:{my:2},children:i}):0===t.length?(0,C.jsx)(o.A,{color:"text.secondary",sx:{my:2},children:"No recent quiz attempts found to use for challenges."}):(0,C.jsxs)(s.A,{sx:{mb:4},children:[(0,C.jsx)(o.A,{variant:"h5",gutterBottom:!0,sx:{color:x,opacity:.85},children:"Initiate Challenge from Recent Quiz"}),(0,C.jsx)(j.A,{dense:!0,sx:{p:0},children:t.slice(0,h?t.length:3).map((e=>(0,C.jsx)(v.A,{result:e,onResultClick:()=>c(e),showDeleteButton:!1},"recent-challengeable-".concat(e.id))))}),t.length>3&&(0,C.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",mt:1},children:(0,C.jsx)(r.A,{onClick:()=>p(!h),sx:{color:x},size:"small",children:h?"Show Less":"Show More (".concat(t.length-3," more)")})})]})};var b=n(3089),S=n(3759);const z=(e,t,n)=>{let l=e||"Unknown Topic";return t&&(l+=" (Class ".concat(t,")")),n&&(l+=" - ".concat(n.charAt(0).toUpperCase()+n.slice(1))),l};const q=function(e){let{challenges:t,isLoading:n,error:d,onPlayChallenge:u,currentUserId:p,accentColor:g}=e;const x=(0,l.A)(),A=g||x.palette.secondary.main;return n?(0,C.jsx)(a.A,{sx:{color:A,display:"block",mx:"auto",my:2}}):d?(0,C.jsx)(f.A,{severity:"error",sx:{my:2},children:d}):0===t.length?(0,C.jsx)(o.A,{color:"text.secondary",sx:{my:2},children:"No incoming challenges."}):(0,C.jsxs)(s.A,{sx:{mb:4},children:[(0,C.jsx)(o.A,{variant:"h5",gutterBottom:!0,sx:{color:A,opacity:.85},children:"Incoming Challenges"}),t.map((e=>(e=>{var t;let n=e.status.charAt(0).toUpperCase()+e.status.slice(1),l="default",s="filled";return"pending"!==e.status&&"challenger_completed"!==e.status||(l="warning",s="outlined"),(0,C.jsx)(i.A,{elevation:2,sx:{mb:2,p:2,borderLeft:"4px solid ".concat(m.J[null===(t=e.subject)||void 0===t?void 0:t.toLowerCase()]||x.palette.grey[500])},children:(0,C.jsxs)(b.A,{container:!0,spacing:1,alignItems:"center",children:[(0,C.jsxs)(b.A,{item:!0,xs:12,sm:8,children:[(0,C.jsx)(o.A,{variant:"h6",sx:{textTransform:"capitalize",fontWeight:500},children:z(e.topic_name,e.quiz_class,e.difficulty)}),(0,C.jsxs)(o.A,{variant:"body2",color:"text.secondary",children:["Challenged by: ",(0,C.jsx)("strong",{children:e.challengerUsername||"A user"})]}),(0,C.jsxs)(o.A,{variant:"caption",display:"block",color:"text.secondary",children:["Received: ",new Date(e.created_at).toLocaleDateString(),e.expires_at&&" (Expires: ".concat(new Date(e.expires_at).toLocaleDateString(),")")]})]}),(0,C.jsxs)(b.A,{item:!0,xs:12,sm:4,container:!0,direction:"column",alignItems:{xs:"flex-start",sm:"flex-end"},spacing:.5,children:[(0,C.jsxs)(b.A,{item:!0,children:[" ",(0,C.jsx)(S.A,{label:n,color:l,size:"small",variant:s})," "]}),("pending"===e.status||"challenger_completed"===e.status&&e.challenged_id===p)&&(0,C.jsx)(b.A,{item:!0,sx:{mt:1},children:(0,C.jsx)(r.A,{variant:"contained",size:"small",startIcon:(0,C.jsx)(h.A,{}),onClick:()=>u(e),sx:{backgroundColor:A,"&:hover":{backgroundColor:(0,c.e$)(A,.2)}},children:"Play Challenge"})})]})]})},e.id)})(e)))]})};const w=function(){var e,t;const n=(0,l.A)(),f=(0,u.Zp)(),{currentUser:j,isLoadingAuth:v}=(0,p.A)(),b=(null===(e=n.palette.challengesAccent)||void 0===e?void 0:e.main)||n.palette.secondary.main,{recentResults:S,isLoadingRecentResults:z,recentResultsError:w,pendingReceivedChallenges:k,isLoadingPending:I,pendingError:_,challengeSetupModalOpen:L,quizDataForChallenge:P,handleOpenChallengeSetupFromRecent:D,handleCloseChallengeSetupModal:R,handleStartChallenge:U}=(e=>{const t=(0,u.Zp)(),[n,l]=(0,g.useState)([]),[s,a]=(0,g.useState)(!1),[o,i]=(0,g.useState)(""),[r,c]=(0,g.useState)([]),[d,h]=(0,g.useState)(!1),[p,m]=(0,g.useState)(""),[A,f]=(0,g.useState)(!1),[j,v]=(0,g.useState)(null),C=(0,g.useCallback)((async()=>{if(null!==e&&void 0!==e&&e.id&&null!==e&&void 0!==e&&e.token){a(!0),i("");try{const t=await x.A.get("/api/results?userId=".concat(e.id,"&limit=5&excludeChallenges=true"),{headers:{Authorization:"Bearer ".concat(e.token)}});l(t.data||[])}catch(s){var t,n;i((null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Failed to load recent quiz attempts.")}finally{a(!1)}}else l([])}),[e]),y=(0,g.useCallback)((async()=>{if(null!==e&&void 0!==e&&e.token){h(!0),m("");try{const t=await x.A.get("/api/challenges/pending",{headers:{Authorization:"Bearer ".concat(e.token)}});c(t.data||[])}catch(l){var t,n;console.error("Error fetching pending challenges:",l.response||l),m((null===(t=l.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Failed to load pending challenges.")}finally{h(!1)}}else c([])}),[e]);return(0,g.useEffect)((()=>{e?(C(),y()):(l([]),c([]),i(""),m(""))}),[e,y,C]),{recentResults:n,isLoadingRecentResults:s,recentResultsError:o,pendingReceivedChallenges:r,isLoadingPending:d,pendingError:p,challengeSetupModalOpen:A,quizDataForChallenge:j,handleOpenChallengeSetupFromRecent:n=>{e?n.questionsActuallyAttemptedIds&&0!==n.questionsActuallyAttemptedIds.length?(v({topicId:n.topicId,topicName:n.topicName,difficulty:n.difficulty,numQuestions:n.questionsActuallyAttemptedIds.length,quizClass:n.class,questionIds:n.questionsActuallyAttemptedIds,subject:n.subject}),f(!0)):alert("Cannot initiate challenge: This result has no question data."):t("/login",{state:{from:"/challenges",message:"Please login to challenge a friend."}})},handleCloseChallengeSetupModal:()=>{f(!1),v(null)},handleStartChallenge:e=>{t("/quiz/challenge-".concat(e.id),{state:{quizType:"challenge",challengeId:e.id,topicId:e.topic_id,topicName:e.topic_name||"Challenge #".concat(e.id),difficulty:e.difficulty,numQuestions:e.num_questions,quizClass:e.quiz_class,questionIds:e.question_ids_json?JSON.parse(e.question_ids_json):null,subject:e.subject||e.topic_id.split("-")[0]||"challenge",timeLimit:e.time_limit||null,currentChallengeDetails:e}})}}})(j);return v?(0,C.jsxs)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"70vh"},children:[(0,C.jsx)(a.A,{sx:{color:b}}),(0,C.jsx)(o.A,{sx:{ml:2},children:"Loading Challenges..."})]}):j?(0,C.jsxs)(s.A,{sx:{p:{xs:1,sm:2,md:3},maxWidth:"900px",margin:"auto",mt:2},children:[(0,C.jsxs)(o.A,{variant:"h4",gutterBottom:!0,sx:{color:b,fontWeight:"bold",textAlign:"center",mb:3},children:[(0,C.jsx)(h.A,{sx:{verticalAlign:"middle",mr:1,fontSize:"1.3em",color:b}}),"My Challenges"]}),(0,C.jsx)(y,{results:S,isLoading:z,error:w,onInitiateChallenge:D,accentColor:b}),(0,C.jsx)(d.A,{sx:{my:4}}),(0,C.jsx)(q,{challenges:k,isLoading:I,error:_,onPlayChallenge:U,currentUserId:null===j||void 0===j?void 0:j.id,accentColor:b}),P&&(0,C.jsx)(A.A,{open:L,onClose:R,currentUser:j,quizDataForChallenge:P,accentColor:m.J[null===(t=P.subject)||void 0===t?void 0:t.toLowerCase()]||b})]}):(0,C.jsx)(s.A,{sx:{p:3,textAlign:"center",maxWidth:"600px",margin:"auto",mt:4},children:(0,C.jsxs)(i.A,{elevation:3,sx:{p:3,borderTop:"4px solid ".concat(b)},children:[(0,C.jsx)(o.A,{variant:"h6",children:"Please log in to view and manage challenges."}),(0,C.jsx)(r.A,{variant:"contained",onClick:()=>f("/login"),sx:{mt:2,backgroundColor:b,"&:hover":{backgroundColor:(0,c.e$)(b,.2)}},children:"Go to Login"})]})})}},7872:(e,t,n)=>{n.d(t,{A:()=>j});var l=n(9379),s=n(267),a=n(4799),o=n(9826),i=n(3969),r=n(298),c=n(5895),d=n(3759),u=n(8065),h=n(2579),p=n(5362),g=n(5452),x=n(9002),m=n(3777),A=n(9468),f=n(579);const j=function(e){var t;let{result:n,onDeleteClick:j,showDeleteButton:v,isChallengeResult:C}=e;const y=(0,s.A)(),b=(0,x.Zp)();if(!n)return null;const S=(0,A.u0)(n.topicId,n.topicName,C,n),z=m.J[null===(t=n.subject)||void 0===t?void 0:t.toLowerCase()]||y.palette.grey[700];return(0,f.jsxs)(a.A,{onClick:()=>{n&&n.id&&b("/results/".concat(n.id))},sx:{p:1.5,height:"100%",display:"flex",flexDirection:"column",borderRadius:2,borderLeft:"4px solid ".concat(z),cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-3px)",boxShadow:y.shadows[5],backgroundColor:(0,o.X4)(y.palette.action.hover,.06)}},elevation:2,children:[(0,f.jsxs)(i.A,{sx:{flexGrow:1},children:[(0,f.jsxs)(r.A,{direction:"row",spacing:1,alignItems:"center",sx:{mb:1},children:[C&&(0,f.jsx)(g.A,{sx:{color:z,fontSize:"1rem"}}),(0,f.jsx)(c.A,{variant:"subtitle1",sx:{textTransform:"capitalize",fontWeight:500,color:z,lineHeight:1.2,flexGrow:1},children:S})]}),(0,f.jsxs)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:.5,alignItems:"center"},children:[n.class&&(0,f.jsx)(d.A,{label:"Class ".concat(n.class),size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:"18px"}}),n.difficulty&&(0,f.jsx)(d.A,{label:n.difficulty,size:"small",variant:"outlined",sx:{textTransform:"capitalize",fontSize:"0.7rem",height:"18px"}}),(0,f.jsx)(d.A,{label:new Date(n.timestamp).toLocaleDateString(),size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:"18px"}})]})]}),(0,f.jsxs)(r.A,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mt:1.5,pt:1,borderTop:"1px solid ".concat(y.palette.divider)},children:[(0,f.jsx)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:(0,f.jsxs)(c.A,{variant:"body2",sx:{fontWeight:"bold"},children:[n.score,"/",n.totalQuestions]})}),(0,f.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,f.jsx)(d.A,{label:"".concat(n.percentage,"%"),sx:(0,l.A)({fontWeight:"bold",fontSize:"0.9rem",height:"26px"},(q=n.percentage,q>=70?{backgroundColor:y.palette.success.main,color:y.palette.getContrastText(y.palette.success.main)}:q>=50?{backgroundColor:y.palette.warning.main,color:y.palette.getContrastText(y.palette.warning.main)}:{backgroundColor:y.palette.error.main,color:y.palette.getContrastText(y.palette.error.main)}))}),v&&j&&(0,f.jsx)(u.A,{title:"Delete Result",children:(0,f.jsx)(h.A,{size:"small",onClick:e=>{e.stopPropagation(),j(n.id)},sx:{color:y.palette.error.light,"&:hover":{backgroundColor:(0,o.X4)(y.palette.error.main,.2)}},children:(0,f.jsx)(p.A,{fontSize:"small"})})})]})]})]});var q}},9468:(e,t,n)=>{n.d(t,{R3:()=>o,a3:()=>s,u0:()=>a});var l=n(9379);const s=e=>Array.isArray(e)?e.map((e=>{if(!e||"object"!==typeof e)return console.warn("[quizUtils] Encountered invalid item in questionsArray:",e),e;let t=[];if("string"===typeof e.options)try{t=JSON.parse(e.options),Array.isArray(t)||(console.warn("[quizUtils] Parsed options for Q ID ".concat(e.id," is not an array:"),t),t=[])}catch(n){console.error("[quizUtils] Failed to parse options for question ID ".concat(e.id,":"),e.options,n)}else Array.isArray(e.options)?t=e.options:void 0!==e.options&&null!==e.options&&console.warn("[quizUtils] Question ID ".concat(e.id," has unexpected options format (not string or array):"),e.options);return(0,l.A)((0,l.A)({},e),{},{options:t})})):(console.warn("[quizUtils] parseQuestionOptions received non-array input:",e),[]),a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(n&&null!==l&&void 0!==l&&l.topic_name)return"Challenge: ".concat(l.topic_name);if(n&&t)return"Challenge: ".concat(t);if(n)return"Challenge: ".concat(e?String(e).replace(/-/g," "):"Quiz");if(t&&e&&t!==String(e).replace(/-/g," "))return t;if(!e)return"N/A";let s=String(e).replace(/-/g," ");s=s.replace(/^homibhabha practice /i,"Homi Bhabha Practice - "),s=s.replace(/^pyq /i,"PYQ ");return s=s.replace(/\s(\d+(?:st|nd|rd|th))$/i,((e,t)=>" - Class ".concat(t.toUpperCase()))).trim(),s=s.split(" ").map((e=>"class"===e.toLowerCase()||"std"===e.toLowerCase()?e:e.includes("-")?e.split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join("-"):e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(" "),s=s.replace(/Homi Bhabha Practice - (\w+) (\w+)/i,((e,t,n)=>"Homi Bhabha Practice - Std ".concat(t," (").concat(n.charAt(0).toUpperCase()+n.slice(1),")"))),s=s.replace(/Pyq (\w+) (\d+)/i,((e,t,n)=>"PYQ - Std ".concat(t," (").concat(n,")"))),s=s.replace(/Pyq - Class (\w+) \((\d+)\)/i,((e,t,n)=>"PYQ - Std ".concat(t," (").concat(n,")"))),s},o=e=>{if(!e||!Array.isArray(e))return[];let t,n=e.length;for(;0!==n;)t=Math.floor(Math.random()*n),n--,[e[n],e[t]]=[e[t],e[n]];return e}}}]);
//# sourceMappingURL=760.b73abae2.chunk.js.map